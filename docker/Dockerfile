FROM apache/airflow:2.7.2-python3.10

USER root

# ğŸ§± í•„ìˆ˜ ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    ffmpeg \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# ğŸ—ï¸ ì‘ì—… ë””ë ‰í† ë¦¬
WORKDIR /opt/airflow

# ğŸ§¾ requirements.txt ë³µì‚¬
COPY requirements.txt /opt/airflow/requirements.txt

# Airflow ì»¨í…Œì´ë„ˆëŠ” 'airflow' ìœ ì €ë¡œ íŒŒì´ì¬ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ê¶Œì¥
USER airflow

# ğŸ”¼ pip ìµœì‹ í™” + í”„ë¡œì íŠ¸ ì˜ì¡´ì„± ì„¤ì¹˜ + yt-dlp ìµœì‹ í™”
#  - requirements.txt ì„¤ì¹˜ í›„ yt-dlpë¥¼ ë³„ë„ë¡œ ìµœì‹ í™”í•˜ì—¬
#    requirementsì— pinì´ ìˆë”ë¼ë„ ìµœì¢…ì ìœ¼ë¡œ ìµœì‹  yt-dlpê°€ ì‚¬ìš©ë˜ë„ë¡ í•¨
RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r /opt/airflow/requirements.txt \
    && pip install --no-cache-dir --upgrade yt-dlp